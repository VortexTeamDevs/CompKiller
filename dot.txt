local VortexHub = {}
local TS = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local HTTPS = game:GetService("HttpService")

-- Temel değişkenler
local userData = {
    pfp = "https://www.roblox.com/headshot-thumbnail/image?userId="..game.Players.LocalPlayer.UserId.."&width=420&height=420&format=png",
    user = game.Players.LocalPlayer.Name,
    tag = tostring(math.random(1000,9999))
}

-- Basitleştirilmiş draggable fonksiyonu
local function MakeDraggable(frame, holder)
    local dragging, dragInput, dragStart, startPos
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = holder.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)
    UIS.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            holder.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- Ana UI oluşturma
local MainUI = Instance.new("ScreenGui")
MainUI.Name = "VortexHub"
MainUI.Parent = game.CoreGui

function VortexHub:Window(title)
    local elements = {}
    local minimized = false
    
    -- Ana container
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 550, 0, 400)
    MainFrame.Position = UDim2.new(0.5, -275, 0.5, -200)
    MainFrame.BackgroundColor3 = Color3.fromRGB(30, 32, 37)
    MainFrame.Parent = MainUI
    
    -- Header
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1, 0, 0, 25)
    Header.BackgroundColor3 = Color3.fromRGB(25, 27, 32)
    Header.Parent = MainFrame
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(0, 200, 1, 0)
    Title.Text = "Vortex'Hub - " .. title
    Title.TextColor3 = Color3.fromRGB(114, 137, 228)
    Title.BackgroundTransparency = 1
    Title.Font = Enum.Font.Gotham
    Title.TextSize = 12
    Title.Parent = Header
    
    -- Kontrol butonları
    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Size = UDim2.new(0, 25, 1, 0)
    CloseBtn.Position = UDim2.new(1, -25, 0, 0)
    CloseBtn.Text = "X"
    CloseBtn.TextColor3 = Color3.fromRGB(255,255,255)
    CloseBtn.BackgroundColor3 = Color3.fromRGB(25,27,32)
    CloseBtn.Parent = Header
    
    local MinBtn = Instance.new("TextButton")
    MinBtn.Size = UDim2.new(0, 25, 1, 0)
    MinBtn.Position = UDim2.new(1, -50, 0, 0)
    MinBtn.Text = "_"
    MinBtn.TextColor3 = Color3.fromRGB(255,255,255)
    MinBtn.BackgroundColor3 = Color3.fromRGB(25,27,32)
    MinBtn.Parent = Header
    
    -- Sidebar (Servers)
    local Sidebar = Instance.new("Frame")
    Sidebar.Size = UDim2.new(0, 60, 0, 375)
    Sidebar.Position = UDim2.new(0, 0, 0, 25)
    Sidebar.BackgroundColor3 = Color3.fromRGB(25,27,32)
    Sidebar.Parent = MainFrame
    
    local ServerContainer = Instance.new("ScrollingFrame")
    ServerContainer.Size = UDim2.new(1, 0, 1, 0)
    ServerContainer.BackgroundTransparency = 1
    ServerContainer.ScrollBarThickness = 2
    ServerContainer.Parent = Sidebar
    
    local ServerLayout = Instance.new("UIListLayout")
    ServerLayout.Parent = ServerContainer
    
    -- Content Area
    local ContentArea = Instance.new("Frame")
    ContentArea.Size = UDim2.new(0, 490, 0, 375)
    ContentArea.Position = UDim2.new(0, 60, 0, 25)
    ContentArea.BackgroundColor3 = Color3.fromRGB(35,37,42)
    ContentArea.Parent = MainFrame
    
    -- Event handlers
    MakeDraggable(Header, MainFrame)
    
    CloseBtn.MouseButton1Click:Connect(function()
        MainFrame:Destroy()
    end)
    
    MinBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        ContentArea.Visible = not minimized
        Sidebar.Visible = not minimized
        MainFrame.Size = minimized and UDim2.new(0,550,0,25) or UDim2.new(0,550,0,400)
    end)
    
    -- Server fonksiyonu
    function elements:Server(name, icon)
        local server = {}
        local serverBtn = Instance.new("TextButton")
        serverBtn.Size = UDim2.new(0, 45, 0, 45)
        serverBtn.Position = UDim2.new(0.5, -22.5, 0, #ServerContainer:GetChildren() * 50 + 10)
        serverBtn.BackgroundColor3 = Color3.fromRGB(35,37,42)
        serverBtn.Text = icon and "" or string.sub(name,1,1)
        serverBtn.TextColor3 = Color3.fromRGB(255,255,255)
        serverBtn.Parent = ServerContainer
        
        if icon then
            local iconImg = Instance.new("ImageLabel")
            iconImg.Size = UDim2.new(0, 25, 0, 25)
            iconImg.Position = UDim2.new(0.5, -12.5, 0.5, -12.5)
            iconImg.BackgroundTransparency = 1
            iconImg.Image = icon
            iconImg.Parent = serverBtn
        end
        
        -- Server content
        local serverContent = Instance.new("Frame")
        serverContent.Size = UDim2.new(1, 0, 1, 0)
        serverContent.BackgroundColor3 = Color3.fromRGB(40,42,47)
        serverContent.Visible = false
        serverContent.Parent = ContentArea
        
        local serverTitle = Instance.new("TextLabel")
        serverTitle.Size = UDim2.new(1, 0, 0, 30)
        serverTitle.Text = name
        serverTitle.TextColor3 = Color3.fromRGB(255,255,255)
        serverTitle.BackgroundTransparency = 1
        serverTitle.Font = Enum.Font.Gotham
        serverTitle.Parent = serverContent
        
        -- Channel container
        local channelContainer = Instance.new("ScrollingFrame")
        channelContainer.Size = UDim2.new(0, 120, 1, -30)
        channelContainer.Position = UDim2.new(0, 0, 0, 30)
        channelContainer.BackgroundColor3 = Color3.fromRGB(35,37,42)
        channelContainer.Parent = serverContent
        
        -- Element container
        local elementContainer = Instance.new("ScrollingFrame")
        elementContainer.Size = UDim2.new(0, 370, 1, -30)
        elementContainer.Position = UDim2.new(0, 120, 0, 30)
        elementContainer.BackgroundColor3 = Color3.fromRGB(40,42,47)
        elementContainer.Parent = serverContent
        
        serverBtn.MouseButton1Click:Connect(function()
            for _,v in pairs(ContentArea:GetChildren()) do
                if v:IsA("Frame") then v.Visible = false end
            end
            serverContent.Visible = true
        end)
        
        -- Channel fonksiyonu
        function server:Channel(channelName)
            local channel = {}
            
            local channelBtn = Instance.new("TextButton")
            channelBtn.Size = UDim2.new(0, 110, 0, 25)
            channelBtn.Position = UDim2.new(0, 5, 0, #channelContainer:GetChildren() * 30 + 5)
            channelBtn.BackgroundColor3 = Color3.fromRGB(40,42,47)
            channelBtn.Text = "# " .. channelName
            channelBtn.TextColor3 = Color3.fromRGB(150,150,150)
            channelBtn.TextXAlignment = Enum.TextXAlignment.Left
            channelBtn.Parent = channelContainer
            
            local elementFrame = Instance.new("ScrollingFrame")
            elementFrame.Size = UDim2.new(1, -10, 1, -10)
            elementFrame.Position = UDim2.new(0, 5, 0, 5)
            elementFrame.BackgroundTransparency = 1
            elementFrame.Visible = false
            elementFrame.Parent = elementContainer
            
            channelBtn.MouseButton1Click:Connect(function()
                for _,v in pairs(elementContainer:GetChildren()) do
                    if v:IsA("ScrollingFrame") then v.Visible = false end
                end
                elementFrame.Visible = true
            end)
            
            -- UI Element fonksiyonları
            function channel:Button(text, callback)
                local btn = Instance.new("TextButton")
                btn.Size = UDim2.new(1, 0, 0, 30)
                btn.Position = UDim2.new(0, 0, 0, #elementFrame:GetChildren() * 35)
                btn.BackgroundColor3 = Color3.fromRGB(114, 137, 228)
                btn.Text = text
                btn.TextColor3 = Color3.fromRGB(255,255,255)
                btn.Parent = elementFrame
                
                btn.MouseButton1Click:Connect(function()
                    pcall(callback)
                end)
                
                return btn
            end
            
            function channel:Toggle(text, callback)
                local toggle = {}
                local state = false
                
                local toggleFrame = Instance.new("Frame")
                toggleFrame.Size = UDim2.new(1, 0, 0, 25)
                toggleFrame.Position = UDim2.new(0, 0, 0, #elementFrame:GetChildren() * 30)
                toggleFrame.BackgroundTransparency = 1
                toggleFrame.Parent = elementFrame
                
                local toggleText = Instance.new("TextLabel")
                toggleText.Size = UDim2.new(0, 200, 1, 0)
                toggleText.Text = text
                toggleText.TextColor3 = Color3.fromRGB(200,200,200)
                toggleText.BackgroundTransparency = 1
                toggleText.TextXAlignment = Enum.TextXAlignment.Left
                toggleText.Parent = toggleFrame
                
                local toggleBtn = Instance.new("TextButton")
                toggleBtn.Size = UDim2.new(0, 40, 0, 20)
                toggleBtn.Position = UDim2.new(1, -45, 0.5, -10)
                toggleBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
                toggleBtn.Text = ""
                toggleBtn.Parent = toggleFrame
                
                local toggleDot = Instance.new("Frame")
                toggleDot.Size = UDim2.new(0, 16, 0, 16)
                toggleDot.Position = UDim2.new(0, 2, 0.5, -8)
                toggleDot.BackgroundColor3 = Color3.fromRGB(255,255,255)
                toggleDot.Parent = toggleBtn
                
                function toggle:Set(value)
                    state = value
                    if state then
                        toggleBtn.BackgroundColor3 = Color3.fromRGB(114, 137, 228)
                        toggleDot.Position = UDim2.new(1, -18, 0.5, -8)
                    else
                        toggleBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
                        toggleDot.Position = UDim2.new(0, 2, 0.5, -8)
                    end
                    pcall(callback, state)
                end
                
                toggleBtn.MouseButton1Click:Connect(function()
                    toggle:Set(not state)
                end)
                
                return toggle
            end
            
            function channel:Slider(text, min, max, default, callback)
                local slider = {}
                local value = default or min
                
                local sliderFrame = Instance.new("Frame")
                sliderFrame.Size = UDim2.new(1, 0, 0, 40)
                sliderFrame.Position = UDim2.new(0, 0, 0, #elementFrame:GetChildren() * 45)
                sliderFrame.BackgroundTransparency = 1
                sliderFrame.Parent = elementFrame
                
                local sliderText = Instance.new("TextLabel")
                sliderText.Size = UDim2.new(1, 0, 0, 20)
                sliderText.Text = text .. ": " .. value
                sliderText.TextColor3 = Color3.fromRGB(200,200,200)
                sliderText.BackgroundTransparency = 1
                sliderText.TextXAlignment = Enum.TextXAlignment.Left
                sliderText.Parent = sliderFrame
                
                local track = Instance.new("Frame")
                track.Size = UDim2.new(1, 0, 0, 5)
                track.Position = UDim2.new(0, 0, 1, -15)
                track.BackgroundColor3 = Color3.fromRGB(80,80,80)
                track.Parent = sliderFrame
                
                local fill = Instance.new("Frame")
                fill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
                fill.BackgroundColor3 = Color3.fromRGB(114, 137, 228)
                fill.Parent = track
                
                local dot = Instance.new("TextButton")
                dot.Size = UDim2.new(0, 15, 0, 15)
                dot.Position = UDim2.new((value - min) / (max - min), -7.5, 0.5, -7.5)
                dot.BackgroundColor3 = Color3.fromRGB(255,255,255)
                dot.Text = ""
                dot.Parent = track
                
                local function update(x)
                    local ratio = math.clamp((x - track.AbsolutePosition.X) / track.AbsoluteSize.X, 0, 1)
                    value = math.floor(min + (max - min) * ratio)
                    sliderText.Text = text .. ": " .. value
                    fill.Size = UDim2.new(ratio, 0, 1, 0)
                    dot.Position = UDim2.new(ratio, -7.5, 0.5, -7.5)
                    pcall(callback, value)
                end
                
                dot.MouseButton1Down:Connect(function()
                    local move, kill
                    move = UIS.InputChanged:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.MouseMovement then
                            update(input.Position.X)
                        end
                    end)
                    kill = UIS.InputEnded:Connect(function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 then
                            move:Disconnect()
                            kill:Disconnect()
                        end
                    end)
                end)
                
                return slider
            end
            
            function channel:Label(text)
                local label = Instance.new("TextLabel")
                label.Size = UDim2.new(1, 0, 0, 20)
                label.Position = UDim2.new(0, 0, 0, #elementFrame:GetChildren() * 25)
                label.Text = text
                label.TextColor3 = Color3.fromRGB(150,150,150)
                label.BackgroundTransparency = 1
                label.TextXAlignment = Enum.TextXAlignment.Left
                label.Parent = elementFrame
                
                return label
            end
            
            return channel
        end
        
        return server
    end
    
    -- İlk server'ı otomatik aç
    task.spawn(function()
        wait(0.1)
        if ServerContainer:FindFirstChildWhichIsA("TextButton") then
            ServerContainer:FindFirstChildWhichIsA("TextButton"):MouseButton1Click()
            if ServerContainer:FindFirstChildWhichIsA("TextButton"):FindFirstChildWhichIsA("TextButton") then
                ServerContainer:FindFirstChildWhichIsA("TextButton"):FindFirstChildWhichIsA("TextButton"):MouseButton1Click()
            end
        end
    end)
    
    return elements
end

return VortexHub
